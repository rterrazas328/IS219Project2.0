
/*!
 * Module dependencies
 */

<<<<<<< HEAD
var utils = require('./utils');
=======
var utils = require('./utils')
>>>>>>> 923637243c51b35e8862bfced9d2f31719759a83

/*!
 * Prepare a set of path options for query population.
 *
 * @param {Query} query
 * @param {Object} options
 * @return {Array}
 */

<<<<<<< HEAD
exports.preparePopulationOptions = function preparePopulationOptions(query, options) {
=======
exports.preparePopulationOptions = function preparePopulationOptions (query, options) {
>>>>>>> 923637243c51b35e8862bfced9d2f31719759a83
  var pop = utils.object.vals(query.options.populate);

  // lean options should trickle through all queries
  if (options.lean) pop.forEach(makeLean);

  return pop;
<<<<<<< HEAD
};
=======
}
>>>>>>> 923637243c51b35e8862bfced9d2f31719759a83

/*!
 * Prepare a set of path options for query population. This is the MongooseQuery
 * version
 *
 * @param {Query} query
 * @param {Object} options
 * @return {Array}
 */

<<<<<<< HEAD
exports.preparePopulationOptionsMQ = function preparePopulationOptionsMQ(query, options) {
=======
exports.preparePopulationOptionsMQ = function preparePopulationOptionsMQ (query, options) {
>>>>>>> 923637243c51b35e8862bfced9d2f31719759a83
  var pop = utils.object.vals(query._mongooseOptions.populate);

  // lean options should trickle through all queries
  if (options.lean) pop.forEach(makeLean);

  return pop;
<<<<<<< HEAD
};
=======
}
>>>>>>> 923637243c51b35e8862bfced9d2f31719759a83

/*!
 * If the document is a mapped discriminator type, it returns a model instance for that type, otherwise,
 * it returns an instance of the given model.
 *
 * @param {Model}  model
 * @param {Object} doc
 * @param {Object} fields
 *
 * @return {Model}
 */
exports.createModel = function createModel(model, doc, fields) {
  var discriminatorMapping = model.schema
    ? model.schema.discriminatorMapping
    : null;

  var key = discriminatorMapping && discriminatorMapping.isRoot
    ? discriminatorMapping.key
    : null;

  if (key && doc[key] && model.discriminators && model.discriminators[doc[key]]) {
    return new model.discriminators[doc[key]](undefined, fields, true);
  }

  return new model(undefined, fields, true);
<<<<<<< HEAD
};
=======
}
>>>>>>> 923637243c51b35e8862bfced9d2f31719759a83

/*!
 * Set each path query option to lean
 *
 * @param {Object} option
 */

<<<<<<< HEAD
function makeLean(option) {
  option.options || (option.options = {});
  option.options.lean = true;
}
=======
function makeLean (option) {
  option.options || (option.options = {});
  option.options.lean = true;
}

>>>>>>> 923637243c51b35e8862bfced9d2f31719759a83
