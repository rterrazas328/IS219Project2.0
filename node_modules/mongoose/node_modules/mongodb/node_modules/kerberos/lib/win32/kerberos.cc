#include "kerberos.h"
#include <stdlib.h>
#include <tchar.h>
#include "base64.h"
#include "wrappers/security_buffer.h"
#include "wrappers/security_buffer_descriptor.h"
#include "wrappers/security_context.h"
#include "wrappers/security_credentials.h"

<<<<<<< HEAD
Nan::Persistent<FunctionTemplate> Kerberos::constructor_template;

Kerberos::Kerberos() : Nan::ObjectWrap() {
}

void Kerberos::Initialize(Nan::ADDON_REGISTER_FUNCTION_ARGS_TYPE target) {
  // Grab the scope of the call from Node
  Nan::HandleScope scope;

  // Define a new function template
  Local<FunctionTemplate> t = Nan::New<FunctionTemplate>(New);
  t->InstanceTemplate()->SetInternalFieldCount(1);
  t->SetClassName(Nan::New<String>("Kerberos").ToLocalChecked());

  // Set persistent
  constructor_template.Reset(t);

  // Set the symbol
  Nan::Set(target, Nan::New<String>("Kerberos").ToLocalChecked(), t->GetFunction());
}

NAN_METHOD(Kerberos::New) {
=======
Persistent<FunctionTemplate> Kerberos::constructor_template;

Kerberos::Kerberos() : ObjectWrap() {
}

void Kerberos::Initialize(v8::Handle<v8::Object> target) {
  // Grab the scope of the call from Node
  NanScope();

  // Define a new function template
  Local<FunctionTemplate> t = NanNew<FunctionTemplate>(New);
  t->InstanceTemplate()->SetInternalFieldCount(1);
  t->SetClassName(NanNew<String>("Kerberos"));

  // Set persistent
  NanAssignPersistent(constructor_template, t);

  // Set the symbol
  target->ForceSet(NanNew<String>("Kerberos"), t->GetFunction());
}

NAN_METHOD(Kerberos::New) {
  NanScope();
>>>>>>> 923637243c51b35e8862bfced9d2f31719759a83
  // Load the security.dll library
  load_library();
  // Create a Kerberos instance
  Kerberos *kerberos = new Kerberos();
  // Return the kerberos object
<<<<<<< HEAD
  kerberos->Wrap(info.This());
  // Return the object
  info.GetReturnValue().Set(info.This());
}

// Exporting function
NAN_MODULE_INIT(init) {
=======
  kerberos->Wrap(args.This());
  // Return the object
  NanReturnValue(args.This());
}

// Exporting function
extern "C" void init(Handle<Object> target) {
  NanScope();
>>>>>>> 923637243c51b35e8862bfced9d2f31719759a83
  Kerberos::Initialize(target);
  SecurityContext::Initialize(target);
  SecurityBuffer::Initialize(target);
  SecurityBufferDescriptor::Initialize(target);
  SecurityCredentials::Initialize(target);
}

NODE_MODULE(kerberos, init);
