var Promise = require('../')
<<<<<<< HEAD
  , Domain = require('domain').Domain
  , assert = require('assert');


describe("domains", function () {
  it("exceptions should not breakout of domain boundaries", function (done) {
    if (process.version.indexOf('v0.10') != 0) return done();
    var d = new Domain;
    d.on('error', function (err) {
=======
  , Domain = require('domain')
  , assert = require('assert');

var next = 'function' == typeof setImmediate
  ? setImmediate
  : process.nextTick;

describe("domains", function () {
  it("exceptions should not breakout of domain bounderies", function (done) {
    if (process.version.indexOf('v0.8') == 0) return done();
    var d = Domain.create();
    d.once('error', function (err) {
>>>>>>> 923637243c51b35e8862bfced9d2f31719759a83
      assert.equal(err.message, 'gaga');
      done()
    });

    var p = new Promise();
<<<<<<< HEAD
    d.run(function () {
      p.then(
        function () {}
      ).then(
        function () { throw new Error('gaga'); }
      ).end();
    });

    process.nextTick(function () {
      p.fulfill();
    });
=======

    d.run(function () {
      p.then(function () {

      }).then(function () {
          throw new Error('gaga');
        }).end();
    });

    next(function () {
      p.fulfill();
    })
>>>>>>> 923637243c51b35e8862bfced9d2f31719759a83
  });
});
